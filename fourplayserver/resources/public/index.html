<html>
    <head>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <title>4play Client</title>
        <script>
            var cols = 7;
            var rows = 6;
            var radius = 30;
            var height = 700;
            var width = 600;
            var playerID = -1;
            
            function drawEmptyBoard(){
                var svg = '<svg id="svg" xmlns="http://www.w3.org/2000/svg" version="1.1">'
                for(i=0;i<cols;i++){
                    for(j=0;j<rows;j++){
                        var cx = ((i * (width / cols)) + ((width / cols) / 2));
                        var cy = height - ((j * (height / rows)) + ((height / rows) / 2));
                        svg = svg + '<circle onclick="circle_click(evt)" class="circle" id="circle' + (i + (cols * j)) + '" cx="' + cx + '" cy="' + cy + '" r="30" stroke="black" stroke-width="2" fill="white" />';
                    }
                }
                svg = svg + '</svg>';
                $("body").append(svg);
            }
            
            function renderBoardState(board){
                $(".circle").attr("fill", "white");
                for(i=0;i<board.length;i++){
                    if(board[i] == 1){
                        console.log("#circle" + i)
                        $("#circle" + i).attr("fill", "red");
                    }else if(board[i] == -1){
                        $("#circle" + i).attr("fill", "black");
                    }
                }
            }
            
            function circle_click(evt) {
                var circle = evt.target;
                var id = parseInt(circle["id"].replace("circle", ""));
                var col = id % cols;
                console.log($("#circle" + ((cols * (rows - 1)) + col)).attr("fill") == "white");
                
                if($("#circle" + ((rows * (cols - 1)) + col)).attr("fill") != "white"){
                    console.log("Failed to make move");
                    return false;
                }
            }
            
            function pollCallback(data){
                renderBoardState(data["board"]);
            }
            
            function poll(){
                $.get("/poll", {"id" : playerID}, pollCallback)
            }
    
    
        </script>
    </head>
    <body onload="drawEmptyBoard()"> 
    </body>
</html>